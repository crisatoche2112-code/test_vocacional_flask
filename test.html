<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Test Vocacional - {{ nombre }}</title>


  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" />

  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet" />

  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet" />

  <style>
    body {
      font-family: 'Poppins', sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
      padding: 20px;
      color: #333;
    }
    nav.navbar {
      background-color: #5a32a3;
      margin-bottom: 30px;
    }
    nav.navbar a.navbar-brand {
      color: white;
      font-weight: 600;
      font-size: 1.3rem;
    }
    nav.navbar a.navbar-brand:hover {
      color: #d1c4e9;
    }
    .container-main {
      max-width: 700px;
      margin: auto;
      background: white;
      border-radius: 20px;
      padding: 30px 25px;
      box-shadow: 0 8px 30px rgba(0,0,0,0.15);
    }
    h2 {
      color: #4b2a99;
      font-weight: 700;
      margin-bottom: 20px;
      text-align: center;
    }
    .pregunta {
      display: none;
      margin-bottom: 25px;
    }
    .pregunta.active {
      display: block;
      animation: fadeIn 0.5s ease-in-out;
    }
    @keyframes fadeIn {
      from {opacity: 0; transform: translateY(10px);}
      to {opacity: 1; transform: translateY(0);}
    }
    .progress {
      height: 12px;
      border-radius: 10px;
      background-color: #e9ecef;
      margin-bottom: 25px;
    }
    .progress-bar {
      background-color: #6f42c1;
      font-weight: 600;
      color: white;
      text-align: center;
      line-height: 12px;
      font-size: 0.8rem;
    }
    .btn-primary, .btn-secondary, .btn-success {
      border-radius: 50px;
      font-weight: 600;
      padding: 10px 25px;
      font-size: 1rem;
    }
    .btn-primary:hover { background-color: #5a32a3; border-color: #5a32a3; }
    .btn-secondary:hover { background-color: #4b2a99; border-color: #4b2a99; }
    .btn-success:hover { background-color: #4e9e4e; border-color: #4e9e4e; }
    .form-check-label { font-weight: 500; font-size: 1.05rem; }
  </style>
</head>
<body>
  <nav class="navbar navbar-light">
    <div class="container">
      <a class="navbar-brand" href="{{ url_for('index') }}"><i class="fas fa-home me-2"></i>Inicio</a>
    </div>
  </nav>

  <div class="container-main">
    <h2><i class="fas fa-question-circle me-2"></i>¡Hola, {{ nombre }}! Responde el Test</h2>
    <p class="text-center text-muted mb-4">Selecciona una opción por pregunta. ¡Sé honesto para mejores sugerencias!</p>


    <div class="progress">
      <div class="progress-bar" id="progressBar" role="progressbar" style="width: 0%;">0%</div>
    </div>

    <form method="POST" action="{{ url_for('test') }}" id="testForm">
      {% for pregunta in preguntas %}
      {% set qidx = loop.index0 %}
      <div class="pregunta" id="pregunta{{ qidx }}">
        <h5>Pregunta {{ loop.index }} de {{ preguntas|length }}:</h5>
        <p class="fw-semibold mb-3">{{ pregunta.texto }}</p>


        {% for opcion in pregunta.opciones %}
        <div class="form-check mb-2">
          <input class="form-check-input" type="radio"
                 name="respuesta{{ qidx }}"
                 value="{{ opcion }}"
                 id="op{{ qidx }}_{{ loop.index }}">
          <label class="form-check-label" for="op{{ qidx }}_{{ loop.index }}">{{ opcion }}</label>
        </div>
        {% endfor %}
      </div>
      {% endfor %}

      <div class="d-flex justify-content-center mt-4">
        <button type="button" class="btn btn-secondary me-3" id="prevBtn" style="display:none;">Anterior</button>
        <button type="button" class="btn btn-primary me-3" id="nextBtn">Siguiente</button>
        <button type="submit" class="btn btn-success" id="submitBtn" style="display:none;">Finalizar Test</button>
      </div>
    </form>
  </div>


  {% with messages = get_flashed_messages(with_categories=true) %}
  {% if messages %}
  <div class="container mt-3">
    {% for category, message in messages %}
    <div class="alert alert-{{ 'danger' if category == 'error' else 'success' }} alert-dismissible fade show" role="alert">
      {{ message }}
      <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
    </div>
    {% endfor %}
  </div>
  {% endif %}
  {% endwith %}

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
  <script>
    let current = 0;
    const total = {{ preguntas|length }};
    const preguntasEls = document.querySelectorAll('.pregunta');
    const nextBtn = document.getElementById('nextBtn');
    const prevBtn = document.getElementById('prevBtn');
    const submitBtn = document.getElementById('submitBtn');
    const progressBar = document.getElementById('progressBar');

    function showQuestion(n) {
      preguntasEls.forEach((p, i) => p.classList.toggle('active', i === n));
      const progressPercent = Math.round(((n + 1) / total) * 100);
      progressBar.style.width = progressPercent + "%";
      progressBar.textContent = progressPercent + "%";
      prevBtn.style.display = n === 0 ? 'none' : 'inline-block';
      nextBtn.style.display = n === total - 1 ? 'none' : 'inline-block';
      submitBtn.style.display = n === total - 1 ? 'inline-block' : 'none';
    }

    nextBtn.addEventListener('click', () => {
      const currentRadios = document.querySelectorAll(`#pregunta${current} input[type="radio"]`);
      const selected = Array.from(currentRadios).some(r => r.checked);
      if (!selected) {
        alert('⚠️ Selecciona una opción antes de continuar.');
        return;
      }
      current++;
      showQuestion(current);
    });

    prevBtn.addEventListener('click', () => {
      current--;
      showQuestion(current);
    });

    showQuestion(0);
  </script>
</body>
</html>
